## Redis实现排序 ##


### 背景简介 ###

目前项目中需要把电站依照总发电量进行排序，首页展示明星电站在前。在保证效率的同时又要快速展示，如果使用数据库查询，会涉及到电站的系数，单位等的计算，且从数千个电站中列举出前5名的排序比较困难，因此我想着使用redis的zset功能进行实现这个逻辑.


### Redis zset简介 ###

>Redis 有序集合和集合一样也是string类型元素的集合,且不允许重复的成员。
不同的是每个元素都会关联一个double类型的分数。redis正是通过分数来为集合中的成员进行从小到大的排序。
有序集合的成员是唯一的,但分数(score)却可以重复。
集合是通过哈希表实现的，所以添加，删除，查找的复杂度都是O(1)。 集合中最大的成员数为 232 - 1 (4294967295, 每个集合可存储40多亿个成员)。（引用 [菜鸟教程](http://www.runoob.com/redis/redis-sorted-sets.html)）

- 增加成员

	`zadd key scores member`;//key 表示有序集合的key，scores表示有序集合的分数即排序的依据，member即为集合中的成员
- 获取所有成员

	`zcard key`；//返回的是一个key中集合成员的数量
- 获取指定范围的成员

	`zrange key start stop [withscores]`；//返回的是在key集合中从start开始到stop（含头不含尾）范围的成员
- 移除指定范围的成员
	
	`zremrangebyrank key start stop`；//移除指定范围的成员


### 对所有电站的总发电量进行排序 ###

这种情况比较简单，电站作为不重复的单元，可以把其id作为不重复的member成员，把总发电量作为其分数，不断的往集合中插入成员。再使用一个hash存储电站id-电站。这样就可以把整个电站依据发电量进行排序了。

步骤：

	1. zadd stationTotalEnergy totalEnergy stationId
	2. 获取指定范围的电站成员id；如前5，zrange stationTotalEnergy 0 5;

### 指定集合的长度，为前n个成员 ###

这种情况有两种处理方法：
	
	1.先对所有成员进行排序，然后截取前n；
	2.假定放入集合的n个成员就是整个需要排序的对象的前n成员，
  	后面对进入集合的成员与前五进行对比；

两种方法优劣分析：

##### 方法一 #####
如果电站成员过多，对整个集合进行初始化排序的过程会比较长，比较耗时。但是操作简单。

##### 方法二 #####
可以实现动态的排序，例如签到过的成员才进行排序，未签到的，或者没有到达某个逻辑的不进行排序。